/*
 * TilesSquare Maps on jQuery v0.3.6
 * http://tilessquare.org/
 *
 * Copyright 2013-2018 NAGAI Kenshin
 * Released under the MIT license
 *
 * Date: 2018-05-24
 */
function tsAWithB(B,A,C){if(!A&&!C){return true}B.options=$.extend(A,C);return false}function tsPushSuperFunc(C,A){var B=A+"_SUPS";C[B]=(C[B]?C[B]:[]);C[B].push(C[A])}function tsExecSuperFuncs(F,D,C){var B=F[D+"_SUPS"],E=true;for(var A=B.length-1;A>=0&&E!==false&&E!==null;A--){E=B[A].apply(F,C)}return E}function tsGetGetVars(){var D=[],C,A=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var B=0;B<A.length;B++){C=A[B].split("=");D.push(C[0]);D[C[0]]=C[1]}return D}function TSCache(A){if(tsAWithB(this,{},A)){return}this.status=this.NONE=0;this.WAITING=1;this.LOADED=2;this.updateATime=function(){this.atime=(new Date()).getTime()};this.updateATime()}function TSImageCache(B){if(tsAWithB(this,{fadeInSpan:200,uri:""},B)){return}TSCache.call(this,this.options);var A=this;A.status=A.WAITING;this.img=new Image();this.img.src=this.options.uri;this.img.size=0;this.img.onload=function(){A.status=A.LOADED;A.fadeInStart=(new Date()).getTime();A.fadeInEnd=A.fadeInStart+A.options.fadeInSpan;A.size=A.img.width*A.img.height}}TSImageCache.prototype=new TSCache;function TSProjection(A){if(tsAWithB(this,{lon:0,lat:0,zoom:0},A)){return}this.hasLonLat=(A&&A.lon!=undefined&&A.lat!=undefined)}function TSMercatorProjection(A){if(tsAWithB(this,{x:0,y:0},A)){return}TSProjection.call(this,this.options);this.hasXY=(A&&A.x!=undefined&&A.y!=undefined);this.trimXY=function(){var B=Math.pow(2,this.options.zoom);while(this.options.x<0){this.options.x+=B}while(this.options.x>=B){this.options.x-=B}while(this.options.y<0){this.options.y+=B}while(this.options.y>=B){this.options.y-=B}};this.trimLonLat=function(){while(this.options.lon<=-180){this.options.lon+=360}while(this.options.lon>180){this.options.lon-=360}while(this.options.lat<=-90){this.options.lat+=180}while(this.options.lat>90){this.options.lat-=180}};this.makeKey=function(){if(this.hasXY){this.trimXY()}else{this.trimLonLat();this.computeXY()}return this.options.zoom+"/"+~~this.options.x+"/"+~~this.options.y};this.computeXY=function(){this.options.x=(this.options.lon+180)/360*Math.pow(2,this.options.zoom);this.options.y=(1-Math.log(Math.tan(this.options.lat*Math.PI/180)+1/Math.cos(this.options.lat*Math.PI/180))/Math.PI)/2*Math.pow(2,this.options.zoom);this.hasXY=true};this.getXY=function(){if(this.hasXY){this.trimXY()}else{this.trimLonLat();this.computeXY()}return{x:this.options.x,y:this.options.y}};this.computeLonLat=function(){var B=Math.pow(2,this.options.zoom),C=Math.PI-2*Math.PI*this.options.y/B;this.options.lon=this.options.x/B*360-180;this.options.lat=180/Math.PI*Math.atan(0.5*(Math.exp(C)-Math.exp(-C)));this.hasLonLat=true};this.getLonLat=function(){if(this.hasLonLat){this.trimLonLat()}else{this.trimXY();this.computeLonLat()}return{lon:this.options.lon,lat:this.options.lat}}}TSMercatorProjection.prototype=new TSProjection;function TSOSMProjection(A){if(tsAWithB(this,{},A)){return}TSMercatorProjection.call(this,this.options)}TSOSMProjection.prototype=new TSMercatorProjection;function TSDownloader(A){if(tsAWithB(this,{},A)){return}}function TSOSMDownloader(A){if(tsAWithB(this,{subDomain:"a"},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){var C=B.getXY();return new TSImageCache({uri:"https://"+this.options.subDomain+".tile.openstreetmap.org/"+~~B.options.zoom+"/"+~~C.x+"/"+~~C.y+".png"})}}TSOSMDownloader.prototype=new TSDownloader;function TSGSIGoJpStdDownloader(A){if(tsAWithB(this,{},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){var C=B.getXY();return new TSImageCache({uri:"https://cyberjapandata.gsi.go.jp/xyz/std/"+~~B.options.zoom+"/"+~~C.x+"/"+~~C.y+".png"})}}TSGSIGoJpStdDownloader.prototype=new TSDownloader;function TSLocalDownloader(A){if(tsAWithB(this,{bpath:""},A)){return}TSDownloader.call(this,this.options);this.getTileCache=function(B){return new TSImageCache({uri:this.options.bpath+~~B.options.zoom+"/"+~~B.options.x+"/"+~~B.options.y+".png"})}}TSLocalDownloader.prototype=new TSDownloader;function TilesSquare(A){if(tsAWithB(this,{interval:50,moveSpan:700,zoomSpan:400,id:"default",dldrs:[],minZoom:0,maxZoom:18,zoom:12,lon:139.6916667,lat:35.6894444},A)){return}this.initialized=false;this.caches={};this.activated=false;this.dldrIdx=0;this.init=function(B){this.initialized=true;this.isIOS=B.isIOS;this.isAndroid=B.isAndroid;this.isWindowsPhone=B.isWindowsPhone;this.options.interval=B.interval;this.cvsid=B.cvsid;this.cdtid=B.cdtid;this.hasArrows=B.hasArrows;this.arwids=B.arwids;this.hasSlider=B.hasSlider;this.sldid=B.sldid;this.hasPlsMns=B.hasPlsMns;this.pmids=B.pmids;this.hasScale=B.hasScale;this.sclids=B.sclids;this.ovlsid=B.ovlsid;this.popsid=B.popsid;this.onActivate=B.onActivate;this.onDeactivate=B.onDeactivate;this.beforeDrag=B.beforeDrag;this.afterDrag=B.afterDrag;this.beforeMove=B.beforeMove;this.inMoving=B.inMoving;this.afterMove=B.afterMove;this.beforeZoom=B.beforeZoom;this.inZooming=B.inZooming;this.afterZoom=B.afterZoom;this.beforeResize=B.beforeResize;this.afterResize=B.afterResize;this.onDraw=B.onDraw;this.onLoaded=B.onLoaded};this.destroy=function(){};this.activate=function(B){this.activated=true;this.resize(B);this.setCenter(B);if(this.hasSlider){var C=$("#"+this.sldid);C.slider("option","min",this.options.minZoom);C.slider("option","max",this.options.maxZoom);C.slider("option","value",this.options.zoom)}this.retrieve();if(this.onActivate){this.onActivate(this)}$("#"+this.ovlsid).tsoverlays("activate",this);$("#"+this.popsid).tspopups("activate",this);this.draw()};this.deactivate=function(){this.activated=false;if(this.onDeactivate){this.onDeactivate(this)}$("#"+this.ovlsid).tsoverlays("deactivate",this);$("#"+this.popsid).tspopups("deactivate",this)};this.resize=function(B){this.width=B.width;this.height=B.height};this.updateScaleSub=function(I,G){var F=0,H=0,E=[1,2,3,5],B=99;for(var D=I;D>=1&&F==0;D/=10){if(D*G>B*100){continue}for(var C=E.length-1;C>=0;C--){H=E[C]*D;if(H*G<B){F=H*G;break}}}return{s:F,sc:H}};this.updateScale=function(O){var J=O.scale2/180*Math.PI,F=Math.PI/180*6378137*Math.cos(J)/Math.sqrt(1-0.00669447*Math.pow(Math.sin(J),2)),B=O.scale1/F,H=this.updateScaleSub(10000000,B),C=~~H.s,D=6;if(H.s>0){var I=$("#"+this.sclids.kmLine),N=$("#"+this.sclids.kmLabel);I.css("left",(C+D)+"px");N.text(H.sc>1000?(H.sc/1000)+" km":H.sc+" m")}B*=1609.344;var K=" mi";H=this.updateScaleSub(10000,B);if(H.s==0){B/=1760*3;K=" ft";H=this.updateScaleSub(1000,B)}var M=~~H.s;if(H.s>0){var G=$("#"+this.sclids.miLine);G.css("left",(M+D)+"px");var L=$("#"+this.sclids.miLabel);L.text(H.sc+K)}var E=$("#"+this.sclids.horizon);E.css("width",(C>M?C:M)+2)};this.sync=function(){if(this.hasSlider){var B=$("#"+this.sldid);B.slider("option","value",this.options.zoom)}if(this.hasScale){var C=this.deltaElem2LonLat({deltaElemX:100,deltaElemY:this.height-20-(this.height>>1)});while(C.lon<this.options.lon){C.lon+=360}this.updateScale({scale1:100/(C.lon-this.options.lon),scale2:C.lat})}};this.setCenter=function(B){this.options.zoom=(B.zoom===undefined?this.options.zoom:B.zoom);this.options.lon=(B.lon===undefined?this.options.lon:B.lon);this.options.lat=(B.lat===undefined?this.options.lat:B.lat);this.sync()};this.deltaElem2LonLat=function(B){var D=this.getProjection({zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat}),C=this.deltaProjection({prj:D,deltaZ:(B.deltaZ===undefined?0:B.deltaZ),deltaElemX:B.deltaElemX,deltaElemY:B.deltaElemY,preserve:(B.preserve===undefined?B.deltaZ!==undefined:B.preserve)});return C.getLonLat()};this.lonLat2DeltaElem=function(B){var D=this.getProjection({zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat}),C=this.getProjection({zoom:B.zoom?B.zoom:this.options.zoom,lon:B.lon,lat:B.lat});return this.getDeltaElem(D,C)};this.dragTimer=null;this.deltaElemX=0;this.deltaElemY=0;this.dragPhase=0;this.onDrag=function(C){if(this.dragTimer===null){var B=this;this.dragTimer=setTimeout(function(){B.doDrag()},this.options.interval)}this.deltaElemX+=C.deltaElemX?C.deltaElemX:0;this.deltaElemY+=C.deltaElemY?C.deltaElemY:0;this.dragPhase=C.phase?C.phase:0};this.doDrag=function(){this.dragTimer=null;var C={deltaElemX:this.deltaElemX,deltaElemY:this.deltaElemY,phase:this.dragPhase};this.deltaElemX=0;this.deltaElemY=0;if(C.phase!=1){this.dragPhase=0}if(C.deltaElemX||C.deltaElemY){if(C.phase<2&&Math.abs(C.deltaElemX)<1&&Math.abs(C.deltaElemY)<1){return}var E=this.deltaElem2LonLat(C);this.setCenter({lon:E.lon,lat:E.lat})}this.retrieve();if(this.beforeDrag){this.beforeDrag(this,C)}var D=$("#"+this.ovlsid).tsoverlays("beforeDrag",this,C),B=$("#"+this.popsid).tspopups("beforeDrag",this,C);this.draw();D.tsoverlays("afterDrag",this,C);B.tspopups("afterDrag",this,C);if(this.afterDrag){this.afterDrag(this,C)}};this.onMove=function(C){var B=(new Date()).getTime();this.moveReq={zoom:this.options.zoom,elemX:C.elemX,elemY:C.elemY,moveStart:B,moveEnd:B+this.options.moveSpan};var D=this.deltaElem2LonLat({deltaElemX:C.elemX-(this.width>>1),deltaElemY:C.elemY-(this.height>>1)});this.setCenter({lon:D.lon,lat:D.lat});this.retrieve();if(this.beforeMove){this.beforeMove(this,this.moveReq)}$("#"+this.ovlsid).tsoverlays("beforeMove",this,this.moveReq);$("#"+this.popsid).tspopups("beforeMove",this,this.moveReq);this.draw()};this.zoomTimer=null;this.deltaZ=0;this.elemX=0;this.elemY=0;this.onZoom=function(D){var C=document.getElementById(this.cvsid);this.elemX=(D.elemX===undefined?$(C).width()>>1:D.elemX);this.elemY=(D.elemY===undefined?$(C).height()>>1:D.elemY);if(D.zoom===undefined){if(this.zoomTimer===null){var B=this;this.zoomTimer=setTimeout(function(){B.doZoom(true)},this.options.interval)}this.deltaZ+=D.deltaZ}else{if(this.zoomTimer!==null){clearTimeout(this.zoomTimer);this.zoomTimer=null}this.deltaZ=D.zoom-this.options.zoom;this.doZoom(false)}};this.doZoom=function(C){this.zoomTimer=null;var H=0;if(this.deltaZ>0.9){H=Math.ceil(this.deltaZ);this.deltaZ=0}else{if(this.deltaZ<-0.9){H=Math.floor(this.deltaZ);this.deltaZ=0}}var G=this.elemX,E=this.elemY;this.elemX=0;this.elemY=0;var D=this.options.zoom+H;if(D<this.options.minZoom){D=this.options.minZoom}else{if(D>this.options.maxZoom){D=this.options.maxZoom}}if(D==this.options.zoom){return}var B=(new Date()).getTime();this.zoomReq={zoom:this.options.zoom,preserve:C,elemX:G,elemY:E,zoomStart:B,zoomEnd:B+this.options.zoomSpan};var F=this.deltaElem2LonLat({deltaZ:(C?H:0),deltaElemX:G-(this.width>>1),deltaElemY:E-(this.height>>1),preserve:C});this.setCenter({zoom:D,lon:F.lon,lat:F.lat});this.retrieve();if(this.beforeZoom){this.beforeZoom(this,this.zoomReq)}$("#"+this.ovlsid).tsoverlays("beforeZoom",this,this.zoomReq);$("#"+this.popsid).tspopups("beforeZoom",this,this.zoomReq);this.draw()};this.retrieve=function(){};this.draw=function(){};this.onResize=function(C){var E={width:this.width,height:this.height};this.resize(C);this.retrieve();if(this.beforeResize){this.beforeResize(this,E)}var D=$("#"+this.ovlsid).tsoverlays("beforeResize",this,E),B=$("#"+this.popsid).tspopups("beforeResize",this,E);this.draw();D.tsoverlays("afterResize",this,E);B.tspopups("afterResize",this,E);if(this.afterResize){this.afterResize(this,E)}};this.wheel2deltaZ=function(B){if(B<-4){return -Math.log(-B)/Math.LN2}else{if(B>4){return Math.log(B)/Math.LN2}else{if(-2<B&&B<0){return -1}else{if(0<=B&&B<2){return 1}}}}return B/2};this.pinch2deltaZ=function(B){return Math.log(B)/Math.LN2*2}}function OSMTilesSquare(A){if(tsAWithB(this,{tsize:256,credit:'© <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',dldrs:[new TSOSMDownloader({subDomain:"a"}),new TSOSMDownloader({subDomain:"b"}),new TSOSMDownloader({subDomain:"c"})]},A)){return}TilesSquare.call(this,this.options);this.destroy=function(){};tsPushSuperFunc(this,"activate");this.activate=function(B){tsExecSuperFuncs(this,"activate",arguments);var C=document.getElementById(this.cdtid);$(C).html(this.options.credit)};this.cacheMax=50;tsPushSuperFunc(this,"resize");this.resize=function(B){tsExecSuperFuncs(this,"resize",arguments);this.lhalf=(this.width>>1)/this.options.tsize;this.rhalf=((this.width>>1)-1)/(this.options.tsize-1);this.thalf=(this.height>>1)/this.options.tsize;this.bhalf=((this.height>>1)-1)/(this.options.tsize-1);this.cacheMax=this.width/this.options.tsize*this.height/this.options.tsize*8};this.getProjection=function(B){return new TSOSMProjection(B)};this.deltaProjection=function(D){var E=D.prj.getXY(),B=1;if(D.deltaZ&&D.preserve){var C=Math.pow(2,D.deltaZ);B=1-1/C}return this.getProjection({zoom:this.options.zoom,x:E.x+D.deltaElemX*B/this.options.tsize,y:E.y+D.deltaElemY*B/this.options.tsize})};this.getDeltaElem=function(D,B){var E=D.getXY(),C=B.getXY();return{deltaElemX:(C.x-E.x)*this.options.tsize,deltaElemY:(C.y-E.y)*this.options.tsize}};this.retrieve=function(){var O=this.options.zoom,F=this.getProjection({zoom:O,lon:this.options.lon,lat:this.options.lat}),G=F.getXY(),J=[0.01,1,1.1],E=this.options.dldrs;for(var M=0;M<J.length;M++){var N=Math.floor(G.x-this.lhalf*J[M]),L=Math.floor(G.x+this.rhalf*J[M]),I=Math.floor(G.y-this.thalf*J[M]),H=Math.floor(G.y+this.bhalf*J[M]);for(var P=N;P<=L;P++){for(var D=I;D<=H;D++){var C=this.getProjection({zoom:O,x:P,y:D}),B=C.makeKey();if(!this.caches[B]){var K=E[this.dldrIdx++];if(this.dldrIdx>=E.length){this.dldrIdx=0}this.caches[B]=K.getTileCache(C)}}}}};this.drawTimer=null;this.drawNow=-1;this.draw=function(){if(!this.activated){return}if(this.drawTimer!==null){clearTimeout(this.drawTimer);this.drawTimer=null;this.drawNow=-1}var R=this.options.tsize,f=(new Date()).getTime(),I=document.getElementById(this.cvsid);this.drawNow=f;if(!I.getContext){return}var j=I.getContext("2d"),c=false,E=null,O=null,V=[{zoom:this.options.zoom,scale:1,alpha:1}],G=this.options.lon,T=this.options.lat;if(this.moveReq){var Q=this.moveReq;if(f<Q.moveEnd){var i=(f-Q.moveStart)/(Q.moveEnd-Q.moveStart),g=1-i,H=this.deltaElem2LonLat({deltaElemX:-(Q.elemX-(this.width>>1)),deltaElemY:-(Q.elemY-(this.height>>1))});if(H.lon<-90&&90<=G){G=G*i+(H.lon+360)*g;if(G>=180){G-=360}}else{if(90<H.lon&&G<-90){G=(G+360)*i+H.lon*g;if(G>=180){G-=360}}else{G=G*i+H.lon*g}}T=T*i+H.lat*g;c=true}else{E=this.moveReq;this.moveReq=undefined;this.dragPhase=0}}else{if(this.zoomReq){var a=this.zoomReq;if(f<a.zoomEnd){var i=(f-a.zoomStart)/(a.zoomEnd-a.zoomStart),g=1-i,D=this.options.zoom-a.zoom,W=a.preserve?1:-Math.pow(2,D),H=this.deltaElem2LonLat({deltaZ:(a.preserve?-D*g:0),deltaElemX:W*(a.elemX-(this.width>>1)),deltaElemY:W*(a.elemY-(this.height>>1)),preserve:a.preserve});if(a.preserve){G=H.lon;T=H.lat}else{if(D<0){var n=Math.pow(i,2*-D),S=1-n;G=G*n+H.lon*S;T=T*n+H.lat*S}else{var S=Math.pow(g,2*D),n=1-S;G=G*n+H.lon*S;T=T*n+H.lat*S}}var U=Math.pow(2,D*i);V[0].scale=U/Math.pow(2,D);V[0].alpha=i;V.unshift({zoom:a.zoom,scale:U,alpha:1-Math.pow(i,4)});c=true}else{O=this.zoomReq;this.zoomReq=undefined;this.dragPhase=0}}}for(var r=0;r<V.length;r++){var J=V[r],R=~~(this.options.tsize*J.scale+0.5),C=this.getProjection({zoom:J.zoom,lon:G,lat:T}),F=C.getXY(),U=(J.scale<0.5?0.5:J.scale),e=Math.floor(F.x-this.lhalf/U),d=Math.floor(F.x+this.rhalf/U),M=Math.floor(F.y-this.thalf/U),K=Math.floor(F.y+this.bhalf/U),l=F.x-this.lhalf/J.scale,P=F.y-this.thalf/J.scale;for(var B=e;B<=d;B++){for(var o=M;o<=K;o++){var X=this.getProjection({zoom:J.zoom,x:B,y:o});var N=this.caches[X.makeKey()],Z=Math.round((B-l)*R),Y=Math.round((o-P)*R),b=Math.round((B+1-l)*R)-Z,k=Math.round((o+1-P)*R)-Y;if(N){N.updateATime();if(N.status==N.LOADED){if(f<N.fadeInEnd){c=true;if(r==0){this.drawBlankTile(Z,Y,b,k,1,j)}j.globalAlpha=(f-N.fadeInStart)/(N.fadeInEnd-N.fadeInStart)*J.alpha}else{if(r==0&&J.alpha<0.99999){this.drawBlankTile(Z,Y,b,k,1,j)}j.globalAlpha=J.alpha}j.drawImage(N.img,Z,Y,b,k)}else{c=true;this.drawBlankTile(Z,Y,b,k,r==0?1:J.alpha,j)}}else{this.drawBlankTile(Z,Y,b,k,r==0?1:J.alpha,j)}}}}if(this.onDraw){this.onDraw(this)}if(this.dragTimer===null){if(c){var L=this;this.drawTimer=setTimeout(function(){L.draw()},this.options.interval)}else{this.dispose();if(this.onLoaded){this.onLoaded(this)}}}var m=this.lonLat2DeltaElem({lon:G,lat:T});if(this.moveReq){if(this.inMoving){this.inMoving(this,this.moveReq,m)}$("#"+this.ovlsid).tsoverlays("inMoving",this,this.moveReq,m);$("#"+this.popsid).tspopups("inMoving",this,this.moveReq,m)}else{if(this.zoomReq){if(this.inZooming){this.inZooming(this,this.zoomReq,m)}$("#"+this.ovlsid).tsoverlays("inZooming",this,this.zoomReq,m);$("#"+this.popsid).tspopups("inZooming",this,this.zoomReq,m)}else{if(E){$("#"+this.ovlsid).tsoverlays("afterMove",this,E,m);$("#"+this.popsid).tspopups("afterMove",this,E,m);if(this.afterMove){this.afterMove(this,E,m)}}else{if(O){$("#"+this.ovlsid).tsoverlays("afterZoom",this,O,m);$("#"+this.popsid).tspopups("afterZoom",this,O,m);if(this.afterZoom){this.afterZoom(this,O,m)}}}}}};this.drawBlankTile=function(C,G,D,E,F,B){B.globalAlpha=F;B.fillStyle="#e0e0e0";B.fillRect(C,G,D,E)};this.dispose=function(){var C=this.caches,E=[];for(var D in C){E.push(D)}E.sort(function(H,G){var J=C[H].atime,I=C[G].atime;if(J<I){return -1}if(J>I){return 1}return 0});var F=(E.length<=this.cacheMax?0:E.length-this.cacheMax);for(var B=0;B<F;B++){delete C[E[B]]}}}OSMTilesSquare.prototype=new TilesSquare;function GSIGoJpStdTilesSquare(A){if(tsAWithB(this,{maxZoom:18,credit:'<a href="http://maps.gsi.go.jp/development/ichiran.html">地理院タイル（標準地図）</a>',dldrs:[new TSGSIGoJpStdDownloader({})]},A)){return}OSMTilesSquare.call(this,this.options)}GSIGoJpStdTilesSquare.prototype=new OSMTilesSquare;function TSPointerHandler(A){if(tsAWithB(this,{},A)){return}}function TSMouseHandler(A){if(tsAWithB(this,{},A)){return}TSPointerHandler.call(this,this.options);this.init=function(B){var C=B.map;C.isMouseDown=false;C.isMouseMove=false;C.pageX=0;C.pageY=0;C.singleTimer=null;C.lastWheel=0};this.onMouseDown=function(B){this.isMouseDown=true;this.isMouseMove=false;this.pageX=B.pageX;this.pageY=B.pageY};this.onMouseUp=function(G){if(this.isMouseMove){this.onDrag({phase:2});this.pageX=G.pageX;this.pageY=G.pageY}else{if(this.options.onPointerSingle){if(this.singleTimer!==null){clearTimeout(this.singleTimer)}var I=this,C=$(G.target),F=this.options.active,D=C.offset(),J={elemX:G.pageX-D.left,elemY:G.pageY-D.top},H={deltaElemX:J.elemX-(F.width>>1),deltaElemY:J.elemY-(F.height>>1)},E=F.deltaElem2LonLat(H);this.singleTimer=setTimeout(function(){I.options.onPointerSingle(F,J,E)},300)}}this.isMouseDown=false;this.isMouseMove=false;var B=document.getElementById(this.options.cvsid);$(B).css("cursor","default")};this.onMouseMove=function(C){this.isMouseMove=true;if(this.isMouseDown){if(Math.abs(this.pageX-C.pageX)>0||Math.abs(this.pageY-C.pageY)>0){var B=document.getElementById(this.options.cvsid);$(B).css("cursor","all-scroll");this.onDrag({deltaElemX:this.pageX-C.pageX,deltaElemY:this.pageY-C.pageY,phase:1});this.pageX=C.pageX;this.pageY=C.pageY}}};this.onMouseOut=function(C){if(this.isMouseMove){if(this.dragPhase==1){this.onDrag({phase:2});this.pageX=C.pageX;this.pageY=C.pageY}}this.isMouseMove=false;var B=document.getElementById(this.options.cvsid);$(B).css("cursor","default")};this.onDoubleClick=function(C){if(this.singleTimer!==null){clearTimeout(this.singleTimer);this.singleTimer=null}var B=$(C.target),D=B.offset();this.onZoom({deltaZ:1,elemX:C.pageX-D.left,elemY:C.pageY-D.top})};this.onMouseWheel=function(C,E){C.preventDefault();if(E===undefined){return}if(this.lastWheel>C.timeStamp-this.options.active.options.zoomSpan){return}this.lastWheel=C.timeStamp;var B=$(C.target),D=B.offset();this.onZoom({deltaZ:this.wheel2deltaZ(E),elemX:C.pageX-D.left,elemY:C.pageY-D.top})};this.getAdapter=function(){var B={mousedown:this.onMouseDown,mouseup:this.onMouseUp,mousemove:this.onMouseMove,mouseout:this.onMouseOut,dblclick:this.onDoubleClick,mousewheel:this.onMouseWheel,DOMMouseScroll:this.onMouseWheel,selectstart:function(){return false},dragstart:function(){return false}};return B}}TSMouseHandler.prototype=new TSPointerHandler;function TSTouchHandler(A){if(tsAWithB(this,{},A)){return}TSPointerHandler.call(this,this.options);this.init=function(B){var C=B.map;C.touches=[];C.pushTouches=this.pushTouches;C.touchEnds=[(new Date()).getTime()];C.pushTouchEnds=this.pushTouchEnds;C.singleTimer=null};this.pushTouches=function(G){var H=this.touches,E=(new Date()).getTime()-250;while(H.length>0&&H[0].ts<E){H.shift()}var F=$(G.target),I=F.offset(),D=G.originalEvent.touches,C=[];for(var B=0;B<D.length;B++){C.push({elemX:D[B].pageX-I.left,elemY:D[B].pageY-I.top})}if(C.length>0){H.push({ts:(new Date()).getTime(),tc:C});if(H.length==3){H.shift()}}};this.pushTouchEnds=function(C){var B=this.touchEnds;B.push((new Date()).getTime());if(B.length==3){B.shift()}};this.onTouchStart=function(B){B.preventDefault();this.pushTouches(B)};this.onTouchMove=function(G){G.preventDefault();this.pushTouches(G);this.touchEnds=[];var H=this.touches;if(H.length<2){return}var E=H[0].tc,D=H[1].tc;if(E.length!=D.length){return}if(E.length==1){this.onDrag({deltaElemX:E[0].elemX-D[0].elemX,deltaElemY:E[0].elemY-D[0].elemY,phase:1})}else{if(E.length==2){var B=Math.pow(E[0].elemX-E[1].elemX,2)+Math.pow(E[0].elemY-E[1].elemY,2),C=Math.pow(D[0].elemX-D[1].elemX,2)+Math.pow(D[0].elemY-D[1].elemY,2),F=Math.sqrt(C)/Math.sqrt(B);this.onZoom({deltaZ:this.pinch2deltaZ(F),elemX:(E[0].elemX+E[1].elemX)>>1,elemY:(E[0].elemY+E[1].elemY)>>1})}}};this.onTouchEnd=function(J){J.preventDefault();this.pushTouchEnds(J);var K=this.touchEnds;if(K.length<2){var F=this.touches;if(F.length<2){return}var I=F[0].tc,G=F[1].tc;if(I.length!=1||G.length!=1){return}this.onDrag({phase:2});return}if(this.singleTimer!==null){clearTimeout(this.singleTimer);this.singleTimer=null}if(K[1]-K[0]>300){var N=this,C=$(J.target),H=this.options.active,D=C.offset(),M={elemX:J.originalEvent.changedTouches[0].pageX-D.left,elemY:J.originalEvent.changedTouches[0].pageY-D.top},L={deltaElemX:M.elemX-(H.width>>1),deltaElemY:M.elemY-(H.height>>1)},E=H.deltaElem2LonLat(L);this.singleTimer=setTimeout(function(){N.options.onPointerSingle(H,M,E)},300);return}var F=this.touches;if(F.length<2){return}var I=F[0].tc,G=F[1].tc;if(I.length!=1||G.length!=1){return}var B=Math.pow(G[0].elemX-I[0].elemX,2)+Math.pow(G[0].elemY-I[0].elemY,2);if(B>2500){return}this.onZoom({deltaZ:1,elemX:G[0].elemX,elemY:G[0].elemY})};this.getAdapter=function(){var B={touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd};return B}}TSTouchHandler.prototype=new TSPointerHandler;(function(F){var E="0.3.5",D=navigator.userAgent,A=(D.search(/iPhone/)!=-1||D.search(/iPad/)!=-1||D.search(/iPod/)!=-1),C=(D.search(/Android/)!=-1),B=(D.search(/Windows Phone/)!=-1);F.widget("tlsq.tsoverlays",{options:{version:E,left:0,top:0,ovls:{},mapid:undefined,popsid:undefined,ucnt:0},_create:function(){this.element.css("width","1px").css("height","1px").css("margin","0px").css("padding","0px").css("position","absolute").css("left","0px").css("top","0px")},_setOption:function(G,H){switch(G){case"clear":break}this._super(G,H)},_destroy:function(){},mergeOverlays:function(I){var J=this.element,L=this.options.ovls;for(var G=0;G<I.length;G++){var H=I[G],K=H.attr("id");if(!L[K]){L[K]=H;J.append(L[K])}}},removeOverlays:function(H){var L=this.options.ovls;if(!H){for(var K in L){L[K].remove()}this.options.ovls={};return}if(H.ids){for(var G=0;G<H.ids.length;G++){var K=H.ids[G];if(L[K]){L[K].remove();if(L[K]){delete L[K]}}}}if(H.lon1!==undefined&&H.lon2!==undefined){if(H.lon1<H.lon2){for(var K in L){var J=L[K].data("lon");if(J<H.lon1||H.lon2<J){L[K].remove();if(L[K]){delete L[K]}}}}else{for(var K in L){var J=L[K].data("lon");if((0<J&&J<H.lon1)||(H.lon2<J&&J<=0)){L[K].remove();if(L[K]){delete L[K]}}}}}if(H.lat1!==undefined&&H.lat2!==undefined){for(var K in L){var I=L[K].data("lat");if(I<H.lat1||H.lat2<I){L[K].remove();if(L[K]){delete L[K]}}}}},plot:function(H,I){if(!H){return}if(I){this.options.left=H.width>>1;this.options.top=H.height>>1;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}var M=this.options.ovls;for(var L in M){if(I||M[L].data("status")==1){var G=H.lonLat2DeltaElem({lon:M[L].data("lon"),lat:M[L].data("lat")});var K=G.deltaElemX,J=G.deltaElemY;M[L].left=K;M[L].top=J;M[L].css("left",K+"px").css("top",J+"px");M[L].data("status",2)}}},activate:function(G){this.plot(G,true);this.element.show()},deactivate:function(G){this.element.hide()},beforeDrag:function(H,G){},afterDrag:function(H,G){this.options.left-=G.deltaElemX;this.options.top-=G.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeMove:function(H,G){this.options.left-=G.elemX-(H.width>>1);this.options.top-=G.elemY-(H.height>>1)},inMoving:function(H,G,I){this.element.css("left",(this.options.left-I.deltaElemX)+"px").css("top",(this.options.top-I.deltaElemY)+"px")},afterMove:function(H,G,I){this.options.left-=I.deltaElemX;this.options.top-=I.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeZoom:function(H,G){this.plot(H,true)},inZooming:function(M,N,O){var K=M.drawNow>0?M.drawNow:(new Date()).getTime(),Q=(K-N.zoomStart)/(N.zoomEnd-N.zoomStart),J=Q>1?1:Q,G=1-J,P=M.options.zoom-N.zoom,L=Math.pow(2,-P*G),I=this.options.ovls;for(var H in I){I[H].css("left",(I[H].left-O.deltaElemX)*L+"px").css("top",(I[H].top-O.deltaElemY)*L+"px")}},afterZoom:function(H,G,I){this.plot(H,true)},beforeResize:function(H,G){},afterResize:function(H,G){var J=(H.width-G.width)>>1,I=(H.height-G.height)>>1;this.options.left+=J;this.options.top+=I;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}});F.widget("tlsq.tsoverlay",{options:{version:E,id:undefined,lon:0,lat:0,width:20,height:20,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0},_create:function(){var G=this.element.css("width",this.options.width+"px").css("height",this.options.height+"px").css("margin-left",this.options.marginLeft+"px").css("margin-right",this.options.marginRight+"px").css("margin-top",this.options.marginTop+"px").css("margin-bottom",this.options.marginBottom+"px").css("padding-left",this.options.paddingLeft+"px").css("padding-right",this.options.paddingRight+"px").css("padding-top",this.options.paddingTop+"px").css("padding-bottom",this.options.paddingBottom+"px").css("position","absolute").css("left","0px").css("top","0px");if(this.options.id){G.attr("id",this.options.id)}else{this.options.id="overlay_"+(new Date()).getTime()+~~(Math.random()*1000000);G.attr("id",this.options.id)}if(G.is("a")){if(!G.attr("href")){G.attr("href","javascript:void(0)")}}this.element.data("lon",this.options.lon);this.element.data("lat",this.options.lat);this.element.data("status",1);this.element.data("widgetFullName",this.widgetFullName)},_setOption:function(G,H){switch(G){case"clear":break}this._super(G,H)},_destroy:function(){},getMapID:function(){var H=this.element.parent(),G=H.tsoverlays("option","mapid");if(typeof G!="string"){throw new Error("no parent")}return G},getOverlaysID:function(){var H=this.element.parent();if(!H){throw new Error("no parent")}var G=H.attr("id");if(!G){throw new Error("no parent")}return G},getPopupsID:function(){var H=this.element.parent(),G=H.tsoverlays("option","popsid");if(typeof G!="string"){throw new Error("no parent")}return G}});F.widget("tlsq.tsmarker",F.tlsq.tsoverlay,{options:{src:"TilesSquare/img/marker-b.png",title:"",width:21,height:28,marginTop:-28,marginLeft:-10,elev:6},_create:function(){this._super();var G=F("<img />").css("margin","0px").css("padding","0px").css("border-style","none").css("user-select","none").css("-moz-user-select","none").css("-webkit-user-select","none").css("-ms-user-select","none").attr("width",this.options.width).attr("height",this.options.height).attr("src",this.options.src).attr("alt",this.options.title).attr("onSelectStart","return false;");this.element.append(G);this._on({mouseover:function(J){var I=F(this.element),H=I.attr("id"),L=H+"_tooltip",K=F("<div />").tstooltip({id:L,markerID:H,text:this.options.title});K.tstooltip("open",this)},mouseout:function(J){var I=F(this.element),H=I.attr("id"),K=H+"_tooltip";F("#"+K).tstooltip("close")}})},byPopups:function(){var K=F(this.element),G=K.offset(),I=this.getPopupsID(),J=F("#"+I),H=J.offset();return{left:G.left-this.options.marginLeft-H.left,top:G.top-this.options.marginTop-H.top}}});F.widget("tlsq.tspopups",{options:{version:E,left:0,top:0,pops:{},mapid:undefined,ovlsid:undefined,ucnt:0},_create:function(){this.element.css("width","1px").css("height","1px").css("margin","0px").css("padding","0px").css("position","absolute").css("left","0px").css("top","0px")},_setOption:function(G,H){switch(G){case"clear":break}this._super(G,H)},_destroy:function(){},openPopup:function(G){var H=G.element;var J=H.attr("id");if(!J){this.options.ucnt++;J=this.element.attr("id")+"_"+this.options.ucnt;H.attr("id",J)}var I=this.options.pops;if(!I[J]){I[J]=H;this.element.append(H)}},closePopup:function(H){var G=this.options.pops;if(G[H]){G[H].remove();if(G[H]){delete G[H]}}},closePopups:function(I){var N=this.options.pops;if(!I){for(var M in N){N[M].remove()}this.options.pops={};var H=this.options.mapid,K=F("#"+H).tsmap("option","active");if(K){this.options.left=K.width>>1;this.options.top=K.height>>1;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}return}if(I.ids){for(var G=0;G<I.ids.length;G++){var M=I.ids[G];if(N[M]){N[M].remove();if(N[M]){delete N[M]}}}}if(I.elemX1!==undefined&&I.elemX2!==undefined){for(var M in N){var L=N[M].data("elemX");if(L<I.elemX1||I.elemX2<L){N[M].remove();if(N[M]){delete N[M]}}}}if(I.elemY1!==undefined&&I.elemY2!==undefined){for(var M in N){var J=N[M].data("elemY");if(J<I.elemY1||I.elemY2<J){N[M].remove();if(N[M]){delete N[M]}}}}},activate:function(G){this.closePopups();this.element.show()},deactivate:function(G){this.closePopups();this.element.hide()},beforeDrag:function(H,G){},afterDrag:function(H,G){this.options.left-=G.deltaElemX;this.options.top-=G.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeMove:function(H,G){this.options.left-=G.elemX-(H.width>>1);this.options.top-=G.elemY-(H.height>>1)},inMoving:function(H,G,I){this.element.css("left",(this.options.left-I.deltaElemX)+"px").css("top",(this.options.top-I.deltaElemY)+"px")},afterMove:function(H,G,I){this.options.left-=I.deltaElemX;this.options.top-=I.deltaElemY;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")},beforeZoom:function(H,G){this.closePopups();this.element.hide()},inZooming:function(H,G,I){},afterZoom:function(H,G,I){this.element.show()},beforeResize:function(H,G){},afterResize:function(H,G){var J=(H.width-G.width)>>1,I=(H.height-G.height)>>1;this.options.left+=J;this.options.top+=I;this.element.css("left",this.options.left+"px").css("top",this.options.top+"px")}});F.widget("tlsq.tspopup",{options:{version:E,id:undefined,margin:0,padding:0,fontSize:12},_create:function(){var G=this.element.css("margin",this.options.margin+"px").css("padding",this.options.padding+"px").css("font-size",this.options.fontSize+"px").css("position","absolute").css("left","0px").css("top","0px");if(this.options.id){G.attr("id",this.options.id)}else{this.options.id="popup_"+(new Date()).getTime();G.attr("id",this.options.id)}this.element.data("widgetFullName",this.widgetFullName)},_setOption:function(G,H){switch(G){case"clear":break}this._super(G,H)},_destroy:function(){},getMapID:function(){var H=this.element.parent(),G=H.tspopups("option","mapid");if(typeof G!="string"){throw new Error("no parent")}return G},getOverlaysID:function(){var H=this.element.parent(),G=H.tspopups("option","ovlsid");if(typeof G!="string"){throw new Error("no parent")}return G},getPopupsID:function(){var H=this.element.parent();if(!H){throw new Error("no parent")}var G=H.attr("id");if(!G){throw new Error("no parent")}return G},open:function(H){var G=H.getPopupsID();popups=F("#"+G);popups.tspopups("closePopups");popups.tspopups("openPopup",this)},close:function(H){if(!H){H=this}var G=H.getPopupsID();F("#"+G).tspopups("closePopups")}});F.widget("tlsq.tstooltip",F.tlsq.tspopup,{options:{width:100,padding:4,borderWidth:2},_create:function(){this._super();var G=this.element.css("background-color","#fff").css("padding",this.options.padding+"px").css("width",this.options.width+"px").css("text-align","center").css("position","absolute").css("border",this.options.borderWidth+"px solid #548").css("border-radius","8px").css("opacity","0.0");G=F("<span />").css("margin","0px").css("padding","0px").css("position","relative");if(this.options.text){G.text(this.options.text)}this.element.append(G)},open:function(G){this._super(G);var J=this.element,M=J.children(),I=(this.options.padding+this.options.borderWidth)*2;if(M.width()+I<this.options.width){this.options.width=M.width()+I;J.css("width",this.options.width)}var H=G.byPopups(),I=this.options.padding+this.options.borderWidth,L=H.left-(this.options.width>>1)-I,K=H.top-G.options.height-J.height()-I*2-G.options.elev;J.css("left",L+"px").css("top",(K+4)+"px").animate({top:K+"px",opacity:"0.8"},200)}});F.widget("tlsq.tssignboard",F.tlsq.tspopup,{options:{width:100,height:100,padding:18,borderWidth1:2,borderWidth2:1,closable:false,markerElev:0},_create:function(){this._super();var M=this,J=function(){if(!M.options.closable){return}M.close()};this.options.maskID=this.options.id+"_mask";var O=F("<div />").attr("id",this.options.maskID).css("background-color","black").css("position","absolute").css("opacity","0.6").click(J),H=this.element;H.css("opacity","0.0");H.append(O);this.options.frameID=this.options.id+"_frame";var G=F("<div />").attr("id",this.options.frameID).css("background-color","#dbf").css("position","absolute").css("border",this.options.borderWidth1+"px solid #548").css("border-radius","8px");H.append(G);var K=F("<a />").attr("href","javascript:void(0)").css("position","absolute").css("right","3px").css("top","3px").click(J),L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAVlJREFUOMudk71uFEEQhL/aswSBE8hMhNNLsAnADjBERCRoe+zAuhiR8C5kPAACCbcsAggQweEAIUuAHaCT34InsItk9zQsd/x1NqOq7lJ/MzCoiBD/U6WUUUQ8/JMuInZKKdf6c9OZLwFT4DAinvzGfB84Aj6WUtbmDWyv274jCeBpRDxaYL4HvJOE7eu2b88bZOYZsGUbSUh6VifpJk87M8AkM19HhDSYclPSly4VwGPgTNK0utvLzFe9RwuibgGfVPXuk9meZObzWq8lRG7ZPgIuA735p8l9rSxZ+CrQ9Cm6BFcWCUdLUL2XNLJ9DlxIamw/GI/H32ez2XGtbwbmuxUqgAmw3e9gEeJmMPnDANXLzPxcIwbmiOcYI2JD0kmFajczDwbpNoGv1YD9zHzRP6RT22867WRo7jQnwHZH5Zvtt79stG3bnb/4TDci4upSQdu2//SdfwBsRqV2wx83WgAAAABJRU5ErkJggg==",N=F("<img />").css("margin","0px").css("padding","0px").css("border-style","none").attr("src",L).attr("alt","close button");K.append(N);G.append(K);this.options.contentID=this.options.id+"_content";var I=F("<div />").attr("id",this.options.contentID).css("background-color","#fff").css("margin","0px").css("padding","0px").css("position","absolute").css("border",this.options.borderWidth2+"px inset #ecf").css("left","0px").css("top","0px");G.append(I)},open:function(O){this._super(O);var M=this.getMapID(),X=F("#"+M),G=X.tsmap("option","active"),H=this.getPopupsID(),N=F("#"+H),P=N.offset();F("#"+this.options.maskID).css("width",G.width*3).css("height",G.height*3).css("left",(-P.left-G.width)+"px").css("top",(-P.top-G.height)+"px");if(G.hasSlider){this.options.width=G.width-300;this.options.height=G.height-O.options.height*2-60}else{this.options.width=G.width;this.options.height=G.height-O.options.height*2}var Q=F("#"+this.options.frameID).css("width",this.options.width+"px").css("height",this.options.height+"px"),V=this.options.padding+this.options.borderWidth1;F("#"+this.options.contentID).css("width",(this.options.width-V*2)+"px").css("height",(this.options.height-V*2)+"px").css("left",V+"px").css("top",V+"px");this.options.dmMarkerID=this.options.id+"_dmMarker";var J=O.element.offset(),I=F("<img />").attr("id",this.options.dmMarkerID).attr("src",O.options.src).css("margin","0px").css("padding","0px").css("position","absolute").css("border-style","none").css("left",(J.left-P.left)+"px").css("top",(J.top-P.top)+"px"),U=this.element;U.append(I);var L=O.byPopups(),Q=F("#"+this.options.frameID),V=this.options.borderWidth1,K=L.left-(Q.width()>>1)-V,R=L.top-O.options.height-Q.height()-V*2-O.options.elev,T=500,S=this;Q.css("left",K+"px").css("top",(R+50)+"px");Q.animate({top:R+"px"},T);U.animate({opacity:"1.0"},T);O.element.animate({opacity:"0.0"},T);setTimeout(function(){S.options.closable=true},T);var W=X.offset();G.onMove({elemX:J.left-W.left-O.options.marginLeft,elemY:J.top-W.top-O.options.marginTop-(Q.height()>>1)-V-O.options.elev});this.options.markerElev=O.options.elev},close:function(){var N=500;this.element.animate({opacity:"0"},N);var J=F("#"+this.options.markerID);J.animate({opacity:"1.0"},N);var M=this.getMapID(),G=F("#"+M),K=G.tsmap("option","active"),H=F("#"+this.options.frameID),I=this.options.borderWidth1;K.onMove({elemX:K.width>>1,elemY:(K.height>>1)+(H.height()>>1)+I+this.options.markerElev});var O=this,L=O._super;setTimeout(function(){L(O)},N+20)}});F.widget("tlsq.tsmap",{options:{version:E,width:0,height:0,tss:[],zoom:12,overlays:undefined,lon:139.6916667,lat:35.6894444,hasArrows:!(A||C||B),hasSlider:!(A||C||B),hasPlsMns:true,hasScale:true,active:undefined,onCreate:undefined,onActivate:undefined,onDeactivate:undefined,beforeDrag:undefined,afterDrag:undefined,beforeMove:undefined,inMoving:undefined,afterMove:undefined,beforeZoom:undefined,inZooming:undefined,afterZoom:undefined,beforeResize:undefined,afterResize:undefined,onDraw:undefined,onLoaded:undefined,onPointerSingle:undefined},_create:function(){this.options.isIOS=A;this.options.isAndroid=C;this.options.isWindowsPhone=B;this.options.isAutoFit=(this.options.width==0&&this.options.height==0);var V=this.element.css("position","relative").css("width",this.options.isAutoFit?F(window).width():this.options.width+"px").css("height",this.options.isAutoFit?F(window).height():this.options.height+"px").css("z-index",30000).css("overflow","hidden");var L=V.attr("id");this.options.cvsid=L+"_canvas";var K=F("<canvas />").attr("id",this.options.cvsid).attr("width",this.options.isAutoFit?F(window).width():this.options.width).attr("height",this.options.isAutoFit?F(window).height():this.options.height);V.append(K);this.onDrag=function(Y){if(this.options.active){this.options.active.onDrag(Y)}};this.onMove=function(Y){if(this.options.active){this.options.active.onMove(Y)}};this.onZoom=function(Y){if(this.options.active){this.options.active.onZoom(Y)}};if("ontouchstart" in window&&(A||C||B)){this.pointerHandler=new TSTouchHandler();this.pinch2deltaZ=function(Y){return(this.options.active?this.options.active.pinch2deltaZ(Y):0)}}else{this.pointerHandler=new TSMouseHandler();this.wheel2deltaZ=function(Y){return(this.options.active?this.options.active.wheel2deltaZ(Y):0)}}this.pointerHandler.init({map:this,cvsid:this.options.cvsid});this._on(K,this.pointerHandler.getAdapter());if(this.options.isAutoFit){this.onResize=function(){var Z=F(window).width(),Y=F(window).height(),a=this.options.cvsid;F(this.element).css("width",Z+"px").css("height",Y+"px"),F(document.getElementById(a)).attr("width",Z).attr("height",Y);if(this.options.active){this.options.active.onResize({width:Z,height:Y})}};this._on(window,{resize:this.onResize})}var W=(this.options.overlays?this.options.overlays:F("<div />").tsoverlays()),T=W.attr("id");if(!T){T=L+"_overlays";W.attr("id",T)}this.options.ovlsid=T;V.append(W);this.options.cdtid=L+"_credit";var H=F("<div />").attr("id",this.options.cdtid).css("background-color","rgba(0,0,0,.2)").css("margin","0px").css("padding","2px 6px").css("font-size","10px").css("position","absolute").css("right","0px").css("bottom","0px");V.append(H);var Q=this;var P={nw:[11,11,-1,-1],n:[36,11,0,-1],ne:[61,11,1,-1],w:[11,36,-1,0],e:[61,36,1,0],sw:[11,61,-1,1],s:[36,61,0,1],se:[61,61,1,1]};this.options.arwids={};if(this.options.hasArrows){for(var X in P){this.options.arwids[X]=L+"_arrow_"+X;var G=F("<div />").attr("id",this.options.arwids[X]).css("width","18px").css("height","18px").css("position","absolute").css("left",P[X][0]+"px").css("top",P[X][1]+"px").data("signX",P[X][2]).data("signY",P[X][3]).data("onMove",function(c,b){var a=Q.element,Z=a.width(),Y=a.height();Q.onMove({elemX:~~((Z>>1)+c*Z*2/3),elemY:~~((Y>>1)+b*Y*2/3)})});V.append(G);G.button({icons:{primary:"ui-icon-triangle-1-"+X},text:false}).click(function(Z){Z.preventDefault();var Y=F(this);Y.data("onMove")(Y.data("signX"),Y.data("signY"))})}}this.options.sldid=L+"_slider";if(this.options.hasSlider){var S=F("<div />").attr("id",this.options.sldid).css("height","100px").css("position","absolute").css("top","130px").data("onZoom",function(Y){Q.onZoom({zoom:Y})});V.append(S);S.slider({orientation:"vertical",range:"max",min:0,max:20,slide:function(Y,Z){F(this).data("onZoom")(Z.value)}});S.css("left",~~((90-S.width())/2)+"px");S.children().each(function(){F(this).css("z-index","auto")})}var U;if(this.options.hasArrows){if(this.options.hasSlider){U={plus:[36,101,1],minus:[36,241,-1]}}else{U={plus:[36,101,1],minus:[36,126,-1]}}}else{U={plus:[11,11,1],minus:[11,36,-1]}}this.options.pmids={};if(this.options.hasPlsMns){for(var X in U){this.options.pmids[X]=L+"_"+X;var G=F("<div />").attr("id",this.options.pmids[X]).css("width","18px").css("height","18px").css("position","absolute").css("left",U[X][0]+"px").css("top",U[X][1]+"px").data("deltaZ",U[X][2]).data("onZoom",function(Y){Q.onZoom({deltaZ:Y})});V.append(G);G.button({icons:{primary:"ui-icon-"+X},text:false}).click(function(Z){Z.preventDefault();var Y=F(this);Y.data("onZoom")(Y.data("deltaZ"))})}}var I={left:[2,22,6,10],horizon:[100,2,6,20],kmLine:[2,10,84,22],miLine:[2,10,84,10]},O={kmLabel:[80,10,12,26],miLabel:[80,10,12,6]};this.options.sclids={};if(this.options.hasScale){for(var X in I){this.options.sclids[X]=L+"_scale_"+X;var N=this.options.sclids[X],R=F("<div />").attr("id",N).css("background-color","#000").css("width",I[X][0]+"px").css("height",I[X][1]+"px").css("margin","0px").css("padding","0px").css("position","absolute").css("left",I[X][2]+"px").css("bottom",I[X][3]+"px");V.append(R)}for(var X in O){this.options.sclids[X]=L+"_scale_"+X;var N=this.options.sclids[X],R=F("<div />").attr("id",N).css("width",O[X][0]+"px").css("height",O[X][1]+"px").css("margin","0px").css("padding","0px").css("font-size","10px").css("line-height","10px").css("position","absolute").css("left",O[X][2]+"px").css("bottom",O[X][3]+"px");V.append(R)}}var M=(this.options.popups?this.options.popups:F("<div />").tspopups()),J=M.attr("id");if(!J){J=L+"_popups";M.attr("id",J)}this.options.popsid=J;M.tspopups("option","ovlsid",this.options.ovlsid);W.tsoverlays("option","popsid",J);M.tspopups("option","mapid",L);W.tsoverlays("option","mapid",L);V.append(M);if(this.options.onCreate){this.options.onCreate(L,this.options.ovlsid,this.options.popsid)}},_setOption:function(G,H){switch(G){case"clear":break}this._super(G,H)},_destroy:function(){var H=this.options.tss;for(var G=0;G<H.length;G++){if(H[G].initialized){H[G].destroy()}}},select:function(L){var N=this.options.cvsid,J=F(document.getElementById(N)),K=J.attr("width"),H=J.attr("height"),I=this.options.tss,M=-1;for(var G=0;G<I.length;G++){if(I[G].options.id==L){M=G}else{if(I[G].initialized&&I[G].activated){this.options.zoom=I[G].options.zoom;this.options.lon=I[G].options.lon;this.options.lat=I[G].options.lat;I[G].deactivate()}}}if(M>=0){if(!I[M].initialized){I[M].init({isIOS:this.options.isIOS,isAndroid:this.options.isAndroid,isWindowsPhone:this.options.isWindowsPhone,interval:this.options.interval,cvsid:N,cdtid:this.options.cdtid,hasArrows:this.options.hasArrows,arwids:this.options.arwids,hasSlider:this.options.hasSlider,sldid:this.options.sldid,hasPlsMns:this.options.hasPlsMns,pmids:this.options.pmids,hasScale:this.options.hasScale,sclids:this.options.sclids,ovlsid:this.options.ovlsid,popsid:this.options.popsid,onActivate:this.options.onActivate,onDeactivate:this.options.onDeactivate,beforeDrag:this.options.beforeDrag,afterDrag:this.options.afterDrag,beforeMove:this.options.beforeMove,inMoving:this.options.inMoving,afterMove:this.options.afterMove,beforeZoom:this.options.beforeZoom,inZooming:this.options.inZooming,afterZoom:this.options.afterZoom,beforeResize:this.options.beforeResize,afterResize:this.options.afterResize,onDraw:this.options.onDraw,onLoaded:this.options.onLoaded,width:K,height:H})}if(this.options.zoom<I[M].options.minZoom){this.options.zoom=I[M].options.minZoom}else{if(this.options.zoom>I[M].options.maxZoom){this.options.zoom=I[M].options.maxZoom}}I[M].activate({width:K,height:H,zoom:this.options.zoom,lon:this.options.lon,lat:this.options.lat});this.options.active=I[M]}}})}(jQuery));